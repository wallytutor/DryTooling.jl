%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% textbook.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[oneside]{textbook}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONFIGURATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliography{../../../archive-databases/bibtex/references}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PREAMBLE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{DryTooling Theory Guide}
\author{Walter Dal'Maz Silva}
\date{\today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% COMMANDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\juliaversion}{1.9.0}
\newcommand{\testplatforms}{Windows}

\newcommand{\odiff}[2]{\dfrac{\mathrm{d}\gls{#1}}{\mathrm{d}\gls{#2}}}
\newcommand{\pdiff}[2]{\dfrac{\partial\gls{#1}}{\partial\gls{#2}}}
\newcommand{\orderof}[1]{\mathcal{O}\left(#1\right)}

\newcommand{\addsymbol}[3]{%
	\glsxtrnewsymbol[description={#3\vspace{4pt}}]{#1}{#2}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% SYMBOLS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{symbols.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BODY
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle%

\tableofcontents%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% CHAPTER
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\part{Reactor Modeling}

\chapter{\label{ch:porous-media}Porous media}%

\section{Packed bed porosity modeling}

Modeling of geometrical characteristics of porous beds is required for including both their thermal effect or role over chemistry in chemical reactors. A classical approach used in several commercial and open source tools is that of \textcite{Gunn1978}. In this section we will develop the ideas that lead to an analogous model which is implemented by \lstinline{PackedBedPorosityDescriptor}.

To build the model we will assume a reactor of constant rectangular cross-section $\gls{A}_{r}=\gls{l}_1\gls{l}_2$ and volume  $\gls{V}_{R}=\gls{l}_1\gls{l}_2\gls{l}_3$. Its cross-section perimeter is then $\gls{P}_{R}=2(\gls{l}_1+\gls{l}_2)$. Inside this reactor we randomly pack cubic particles $\beta$ of surface area $\gls{A}_{\beta}=6\gls{l}_{\beta}^2$ and volume $\gls{V}_{\beta}=\gls{l}_{\beta}^3$ at a porosity level $\gls{phi}$. Thus the total volume of solids inside the reactor is $\gls{V}_{S}=(1-\gls{phi})\gls{V}_{R}$ and the approximate number of particles $\gls{N}=\sfrac{\gls{V}_{S}}{\gls{V}_{\beta}}$. Following a similar reasoning the total surface area of particles is $\gls{A}_{S}=\gls{N}\gls{A}_{\beta}$. Performing all the substitutions so far one finds the following expression

\begin{equation}
\gls{A}_{S}=\frac{6(1-\gls{phi})\gls{l}_1\gls{l}_2\gls{l}_3}{\gls{l}_{\beta}}
\end{equation}

Since the differential $d\gls{A}=\gls{P}d\gls{l}$ holds for the surface of a body over its length $\gls{l}$, one can divide the above expression by the reactor length to get the perimeter of particles in a cross-section. We can further divide by the cross-section area itself and find the \emph{perimeter density} which is a more general result, and find the same expression proposed by \textcite{Gunn1978}. This result is summarized in \eqref{eq:perimeter-density-gunn} where the subscript of particle size was dropped for generality.

\begin{equation}
\gls{P} = \frac{6(1-\gls{phi})}{\gls{l}}
\label{eq:perimeter-density-gunn}
\end{equation}

An estimator of the number of channels per unit cross-section of reactor $\gls{N}$ can be related to the porosity through $\gls{N}\pi\gls{R}^2=\gls{phi}$. Because the above perimeter is shared between the fluid volume and solids, it holds that $\gls{N}2\pi\gls{R}=P$. Using these expressions one can solve for the porosity channels characteristic \emph{radius} $\gls{R}$ as given in \eqref{eq:channel-size-gunn}, which is also a result reported by \textcite{Gunn1978}.

\begin{equation}
\gls{R}=\frac{\gls{phi}\gls{l}}{3(1-\gls{phi})}
\label{eq:channel-size-gunn}
\end{equation}

\part{Transport phenomena}

\chapter{\label{ch:thermal-conduction}Thermal conduction}%

\section{Cylindrical coordinates 1-D}

Heat equation formulated with temperature as dependent variable is stated as:

\begin{equation}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=\nabla\cdotp{}(k\nabla{}T)
\end{equation}

For computing the heating dynamics in a cylinder, using the definition of divergence in cylindrical coordinates and using the gradient expansion over the radius we have

\begin{equation}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=
\frac{1}{r}\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)
\end{equation}

To proceed with the finite volume discretization we perform the integration of both sides of the equation over the relevant variables. The order of integration is chosen according to the nature of the derivative term, as discussed by \textcite{Patankar1980}. Care must be taken in the definition of the space integration, which is non-trivial in cylindrical coordinates systems and must be carried over the differential volume $dV$.

\begin{equation}
\int_{V}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}dtdV=
\int_{0}^{\tau}\int_{V}
\frac{1}{r}\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)dVdt
\end{equation}

This differential volume is given by $dV=rdr{}d\theta{}dz$. Since the problem is specified to be symmetric around cylinder center (this must include initial conditions), the azimuth and axial components can be moved outside the time and radial integration and lead to a common $2\pi{}z$ factor in both sides of the equation, which cancels out.

\begin{equation}
\int_{0}^{z}\int_{0}^{2\pi}d\theta{}dz=2\pi{}z
\end{equation}

The integration over radial coordinate introduces the $rdr$ factor from the differential volume and we get the final form of the equation to integrate.

\begin{equation}
\int_{s}^{n}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}rdtdr=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)drdt
\end{equation}

Effecting the inner integration and moving out constant terms from the integrals we have

\begin{equation}
\rho{}c_{p}\left(T_P^{\tau}-T_P^{0}\right)\int_{s}^{n}rdr=
\int_{0}^{\tau}
\left(rk\frac{\partial{}T}{\partial{}r}\right)\bigg\vert_{s}^{n}dt
\end{equation}

Expanding the evaluation of the definite integral between control volume boundaries $s$ and $n$ and performing a Crank-Nicolson integration of the right-hand side one gets

\begin{equation}
\begin{aligned}
	\frac{\rho{}c_{p}}{\tau}
	\left(T_P^{\tau}-T_P^{0}\right)
	\left(\frac{r_n^2}{2}-\frac{r_s^2}{2}\right)
	&=f\left[
	r_nk_n\frac{T_N^{\tau}-T_P^{\tau}}{\delta_{P,N}}-
	r_sk_s\frac{T_P^{\tau}-T_S^{\tau}}{\delta_{P,S}}
	\right]\\[8pt]
	&+(1-f)\left[
	r_nk_n\frac{T_N^{0}-T_P^{0}}{\delta_{P,N}}-
	r_sk_s\frac{T_P^{0}-T_S^{0}}{\delta_{P,S}}
	\right]
\end{aligned}
\end{equation}

Some coefficients appearing in the above equations are now grouped. Notice that for thermal conductivity $k$ which is a function of temperature, the corresponding time-step temperature must be used for its evaluation. For $\beta_{j}$ the lower case $j$ represents the evaluation at the interface with control volume $J$, what is a very specific notation.

\begin{equation}
\begin{aligned}
	\alpha_{P}  & = \frac{\rho{}c_{p}}{2\tau}\left(r_n^2-r_s^2\right)\\[8pt]
	\beta_{j}   & = \frac{r_jk_j}{\delta_{P,J}}
\end{aligned}
\end{equation}

For conciseness we make $g=(1-f)$ and simplify the expression with the new coefficients as

\begin{equation}
-f\beta_{s}T_S+
(\alpha_{P}+f\beta_{n}+f\beta_{s})T_P
-f\beta_{n}T_N
=
g\beta_{s}T_S^{0}+
(\alpha_{P}-g\beta_{n}-g\beta_{s})T_P^{0}+
g\beta_{n}T_N^{0}
\end{equation}

\subsection{Implicit implementation}

For the fully implicit time-stepping scheme $f=1$ the expression reduces to

\begin{equation}
-\beta_{s}T_S+
(\alpha_{P}+\beta_{n}+\beta_{s})T_P
-\beta_{n}T_N
=
\alpha_{P}T_P^{0}
\end{equation}

where the following coefficients are identified

\begin{equation}
\begin{aligned}
	a_{S} & = -\beta_{s}\\[8pt]
	a_{N} & = -\beta_{n}\\[8pt]
	a_{P} & = \alpha_{P}+\beta_{n}+\beta_{s}
\end{aligned}
\end{equation}

and the standard format FVM discretization is reached

\begin{equation}
a_ST_S + a_PT_P + a_NT_N = \alpha_{P}T_P^{0}
\end{equation}

A condition for symmetry is that no flux traverses the center of the cylinder at $r=0$. That implies that *south* derivatives in discrete form of the equation must vanish to enforce $\dot{q}(0,t)=0$, so the first row of the problem is modified to

\begin{equation}
a_1T_P + a_NT_N = \alpha_{P}T_P^{0}\quad\text{where}\quad{}a_1=\alpha_{P}+\beta_{n}
\end{equation}

Over the external radius $r=R$ a Robin boundary condition is imposed. In this case the heat flux $\dot{q}=U(T_\infty-T_P)$ takes the place of *north* term in FVM discretization and the equation writes

\begin{equation}
a_ST_S + a_RT_P = \alpha_{P}T_P^{0}+UT_\infty\quad\text{where}\quad{}a_R=\alpha_{P}+U+\beta_{s}
\end{equation}

It must be noted here that $U=Rh$, where the actual heat transfer coefficient is $h$. This should be self-evident from a dimensional analysis.

\section{Spherical coordinates 1-D}

In the case of spherical coordinates we start with a modification in divergence operator as follows

\begin{equation}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=
\frac{1}{r^2}\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)
\end{equation}

The expression is again integrated over time and the differential volume $dV$.

\begin{equation}
\int_{V}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}dtdV=
\int_{0}^{\tau}\int_{V}
\frac{1}{r^2}\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)dVdt
\end{equation}

This differential volume is given by $dV=r^2\sin\phi{}dr{}d\theta{}d\phi$. Since the problem is specified to be symmetric around sphere center (this must include initial conditions), the polar and azimuth components can be moved outside the time and radial integration and lead to a common $4\pi$ factor in both sides of the equation, which cancels out.

\begin{equation}
\int_{0}^{\pi}\int_{0}^{2\pi}\sin\phi{}d\theta{}d\phi=4\pi
\end{equation}

The integration over radial coordinate introduces the $r^2dr$ factor from the differential volume and we get the final form of the equation to integrate.

\begin{equation}
\int_{s}^{n}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}r^2dtdr=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)drdt
\end{equation}

After effecting the inner integration and moving out constant terms from the integrals and expanding the evaluation of the definite integral between control volume boundaries $s$ and $n$ and performing a Crank-Nicolson integration of the right-hand side one gets

\begin{equation}
\begin{aligned}
	\frac{\rho{}c_{p}}{\tau}
	\left(T_P^{\tau}-T_P^{0}\right)
	\left(\frac{r_n^3}{3}-\frac{r_s^3}{3}\right)
	&=f\left[
	r_n^2k_n\frac{T_N^{\tau}-T_P^{\tau}}{\delta_{P,N}}-
	r_s^2k_s\frac{T_P^{\tau}-T_S^{\tau}}{\delta_{P,S}}
	\right]\\[8pt]
	&+(1-f)\left[
	r_n^2k_n\frac{T_N^{0}-T_P^{0}}{\delta_{P,N}}-
	r_s^2k_s\frac{T_P^{0}-T_S^{0}}{\delta_{P,S}}
	\right]
\end{aligned}
\end{equation}

Some coefficients appearing in the above equations are now grouped. Notice that for thermal conductivity $k$ which is a function of temperature, the corresponding time-step temperature must be used for its evaluation. For $\beta_{j}$ the lower case $j$ represents the evaluation at the interface with control volume $J$, what is a very specific notation.

\begin{equation}
\begin{aligned}
	\alpha_{P}  & = \frac{\rho{}c_{p}}{3\tau}\left(r_n^3-r_s^3\right)\\[8pt]
	\beta_{j}   & = \frac{r_j^2k_j}{\delta_{P,J}}
\end{aligned}
\end{equation}

For conciseness we make $g=(1-f)$ and simplify the expression with the new coefficients as

\begin{equation}
-f\beta_{s}T_S+
(\alpha_{P}+f\beta_{n}+f\beta_{s})T_P
-f\beta_{n}T_N
=
g\beta_{s}T_S^{0}+
(\alpha_{P}-g\beta_{n}-g\beta_{s})T_P^{0}+
g\beta_{n}T_N^{0}
\end{equation}

\subsection{Implicit implementation}

For the fully implicit time-stepping scheme $f=1$ the expression reduces to

\begin{equation}
-\beta_{s}T_S+
(\alpha_{P}+\beta_{n}+\beta_{s})T_P
-\beta_{n}T_N
=
\alpha_{P}T_P^{0}
\end{equation}

where the following coefficients are identified

\begin{equation}
\begin{aligned}
	a_{S} & = -\beta_{s}\\[8pt]
	a_{N} & = -\beta_{n}\\[8pt]
	a_{P} & = \alpha_{P}+\beta_{n}+\beta_{s}
\end{aligned}
\end{equation}

and the standard format FVM discretization is reached

\begin{equation}
a_ST_S + a_PT_P + a_NT_N = \alpha_{P}T_P^{0}
\end{equation}

A condition for symmetry is that no flux traverses the center of the sphere at $r=0$. That implies that *south* derivatives in discrete form of the equation must vanish to enforce $\dot{q}(0,t)=0$, so the first row of the problem is modified to

\begin{equation}
a_1T_P + a_NT_N = \alpha_{P}T_P^{0}\quad\text{where}\quad{}a_1=\alpha_{P}+\beta_{n}
\end{equation}

Over the external radius $r=R$ a Robin boundary condition is imposed. In this case the heat flux $\dot{q}=U(T_\infty-T_P)$ takes the place of *north* term in FVM discretization and the equation writes

\begin{equation}
a_ST_S + a_RT_P = \alpha_{P}T_P^{0}+UT_\infty\quad\text{where}\quad{}a_R=\alpha_{P}+U+\beta_{s}
\end{equation}

It must be noted here that $U=R^2h$, where the actual heat transfer coefficient is $h$. This should be self-evident from a dimensional analysis.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% APPENDIX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\printbibliography%

\appendix%

%\input{annexes/....tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% LIST OF SYMBOLS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\printunsrtglossary[%
    type  = symbols,%
    style = long,%
]%

\end{document}
%
\endinput%