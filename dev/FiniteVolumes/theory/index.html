<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Finite volumes · DryTooling.jl</title><meta name="title" content="Finite volumes · DryTooling.jl"/><meta property="og:title" content="Finite volumes · DryTooling.jl"/><meta property="twitter:title" content="Finite volumes · DryTooling.jl"/><meta name="description" content="Documentation for DryTooling.jl."/><meta property="og:description" content="Documentation for DryTooling.jl."/><meta property="twitter:description" content="Documentation for DryTooling.jl."/><meta property="og:url" content="https://wallytutor.github.io/DryTooling.jl/FiniteVolumes/theory/"/><meta property="twitter:url" content="https://wallytutor.github.io/DryTooling.jl/FiniteVolumes/theory/"/><link rel="canonical" href="https://wallytutor.github.io/DryTooling.jl/FiniteVolumes/theory/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DryTooling.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Module Finite Volumes</span><ul><li><a class="tocitem" href="../">Documentation</a></li><li><a class="tocitem" href="../samples/">Examples</a></li></ul></li><li><span class="tocitem">Module Granular</span><ul><li><a class="tocitem" href="../../Granular/">Documentation</a></li><li><a class="tocitem" href="../../Granular/samples/">Examples</a></li></ul></li><li><span class="tocitem">Module Fluid Models</span><ul><li><a class="tocitem" href="../../FluidModels/">Documentation</a></li><li><a class="tocitem" href="../../FluidModels/samples/">Examples</a></li></ul></li><li><span class="tocitem">Module Cantera</span><ul><li><a class="tocitem" href="../../Cantera/">Documentation</a></li><li><a class="tocitem" href="../../Cantera/samples/">Examples</a></li><li><a class="tocitem" href="../../Cantera/status/">Status</a></li></ul></li><li><span class="tocitem">Module Thermodynamics</span><ul><li><a class="tocitem" href="../../Thermodynamics/">Documentation</a></li><li><a class="tocitem" href="../../Thermodynamics/samples/">Examples</a></li></ul></li><li><span class="tocitem">Module Kinetics</span><ul><li><a class="tocitem" href="../../Kinetics/">Documentation</a></li><li><a class="tocitem" href="../../Kinetics/samples/">Examples</a></li></ul></li><li><span class="tocitem">Module Plug Flow</span><ul><li><a class="tocitem" href="../../PlugFlow/">Documentation</a></li><li><a class="tocitem" href="../../PlugFlow/samples/">Examples</a></li></ul></li><li><a class="tocitem" href="../../Simulation/">Module Simulation</a></li><li><a class="tocitem" href="../../DryTooling/">DryTooling Core</a></li><li><span class="tocitem">Theory Guide</span><ul><li class="is-active"><a class="tocitem" href>Finite volumes</a><ul class="internal"><li><a class="tocitem" href="#Heat-conduction"><span>Heat conduction</span></a></li><li><a class="tocitem" href="#Heat-conduction-formulated-in-enthalpy"><span>Heat conduction formulated in enthalpy</span></a></li><li><a class="tocitem" href="#Mass-transfer"><span>Mass transfer</span></a></li></ul></li><li><a class="tocitem" href="../../Granular/theory/">Granular models</a></li><li><a class="tocitem" href="../../FluidModels/theory/">Fluid models</a></li><li><a class="tocitem" href="../../Thermodynamics/theory/">Thermodynamics</a></li><li><a class="tocitem" href="../../Kinetics/theory/">Kinetics</a></li><li><a class="tocitem" href="../../PlugFlow/theory/">Plug Flow models</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul></li><li><a class="tocitem" href="../../api/">Reference API</a></li><li><a class="tocitem" href="../../toc/">Table of contents</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory Guide</a></li><li class="is-active"><a href>Finite volumes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Finite volumes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/wallytutor/DryTooling.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/wallytutor/DryTooling.jl/blob/main/docs/src/FiniteVolumes/theory.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="DryTooling.FiniteVolumes-theory"><a class="docs-heading-anchor" href="#DryTooling.FiniteVolumes-theory">DryTooling.FiniteVolumes theory</a><a id="DryTooling.FiniteVolumes-theory-1"></a><a class="docs-heading-anchor-permalink" href="#DryTooling.FiniteVolumes-theory" title="Permalink"></a></h1><ul><li><a href="#DryTooling.FiniteVolumes-theory">DryTooling.FiniteVolumes theory</a></li><li class="no-marker"><ul><li><a href="#Heat-conduction">Heat conduction</a></li><li class="no-marker"><ul><li><a href="#Cylindrical-coordinates-1-D">Cylindrical coordinates 1-D</a></li><li><a href="#Spherical-coordinates-1-D">Spherical coordinates 1-D</a></li></ul></li><li><a href="#Heat-conduction-formulated-in-enthalpy">Heat conduction formulated in enthalpy</a></li><li class="no-marker"><ul><li><a href="#Spherical-coordinates-1-D-2">Spherical coordinates 1-D</a></li></ul></li><li><a href="#Mass-transfer">Mass transfer</a></li><li class="no-marker"><ul><li><a href="#Carbon-diffusion-in-plain-iron">Carbon diffusion in plain iron</a></li></ul></li></ul></li></ul><h2 id="Heat-conduction"><a class="docs-heading-anchor" href="#Heat-conduction">Heat conduction</a><a id="Heat-conduction-1"></a><a class="docs-heading-anchor-permalink" href="#Heat-conduction" title="Permalink"></a></h2><h3 id="Cylindrical-coordinates-1-D"><a class="docs-heading-anchor" href="#Cylindrical-coordinates-1-D">Cylindrical coordinates 1-D</a><a id="Cylindrical-coordinates-1-D-1"></a><a class="docs-heading-anchor-permalink" href="#Cylindrical-coordinates-1-D" title="Permalink"></a></h3><p>Heat equation formulated with temperature as dependent variable is stated as:</p><p class="math-container">\[\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=\nabla\cdotp{}(k\nabla{}T)\]</p><p>For computing the heating dynamics in a cylinder, using the definition of divergence in cylindrical coordinates and using the gradient expansion over the radius we have</p><p class="math-container">\[\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=
\frac{1}{r}\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)\]</p><p>To proceed with the finite volume discretization we perform the integration of both sides of the equation over the relevant variables. The order of integration is chosen according to the nature of the derivative term, as discussed by Patankar <a href="../../references/#Patankar1980">[1]</a>. Care must be taken in the definition of the space integration, which is non-trivial in cylindrical coordinates systems and must be carried over the differential volume <span>$dV$</span>.</p><p class="math-container">\[\int_{V}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}dtdV=
\int_{0}^{\tau}\int_{V}
\frac{1}{r}\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)dVdt\]</p><p>This differential volume is given by <span>$dV=rdr{}d\theta{}dz$</span>. Since the problem is specified to be symmetric around cylinder center (this must include initial conditions), the azimuth and axial components can be moved outside the time and radial integration and lead to a common <span>$2\pi{}z$</span> factor in both sides of the equation, which cancels out.</p><p class="math-container">\[\int_{0}^{z}\int_{0}^{2\pi}d\theta{}dz=2\pi{}z\]</p><p>The integration over radial coordinate introduces the <span>$rdr$</span> factor from the differential volume and we get the final form of the equation to integrate.</p><p class="math-container">\[\int_{s}^{n}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}rdtdr=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}r}
\left(rk\frac{\partial{}T}{\partial{}r}\right)drdt\]</p><p>Effecting the inner integration and moving out constant terms from the integrals we have</p><p class="math-container">\[\rho{}c_{p}\left(T_P^{\tau}-T_P^{0}\right)\int_{s}^{n}rdr=
\int_{0}^{\tau}
\left(rk\frac{\partial{}T}{\partial{}r}\right)\bigg\vert_{s}^{n}dt\]</p><p>Expanding the evaluation of the definite integral between control volume boundaries <span>$s$</span> and <span>$n$</span> and performing a Crank-Nicolson integration of the right-hand side one gets</p><p class="math-container">\[\begin{aligned}
    \frac{\rho{}c_{p}}{\tau}
    \left(T_P^{\tau}-T_P^{0}\right)
    \left(\frac{r_n^2}{2}-\frac{r_s^2}{2}\right)
    &amp;=f\left[
    r_nk_n\frac{T_N^{\tau}-T_P^{\tau}}{\delta_{P,N}}-
    r_sk_s\frac{T_P^{\tau}-T_S^{\tau}}{\delta_{P,S}}
    \right]\\[8pt]
    &amp;+(1-f)\left[
    r_nk_n\frac{T_N^{0}-T_P^{0}}{\delta_{P,N}}-
    r_sk_s\frac{T_P^{0}-T_S^{0}}{\delta_{P,S}}
    \right]
\end{aligned}\]</p><p>Some coefficients appearing in the above equations are now grouped. Notice that for thermal conductivity <span>$k$</span> which is a function of temperature, the corresponding time-step temperature must be used for its evaluation. For <span>$\beta_{j}$</span> the lower case <span>$j$</span> represents the evaluation at the interface with control volume <span>$J$</span>, what is a very specific notation.</p><p class="math-container">\[\begin{aligned}
    \alpha_{P}  &amp; = \frac{\rho{}c_{p}}{2\tau}\left(r_n^2-r_s^2\right)\\[8pt]
    \beta_{j}   &amp; = \frac{r_jk_j}{\delta_{P,J}}
\end{aligned}\]</p><p>For conciseness we make <span>$g=(1-f)$</span> and simplify the expression with the new coefficients as</p><p class="math-container">\[-f\beta_{s}T_S+
(\alpha_{P}+f\beta_{n}+f\beta_{s})T_P
-f\beta_{n}T_N
=
g\beta_{s}T_S^{0}+
(\alpha_{P}-g\beta_{n}-g\beta_{s})T_P^{0}+
g\beta_{n}T_N^{0}\]</p><p>\subsection{Implicit implementation}</p><p>For the fully implicit time-stepping scheme <span>$f=1$</span> the expression reduces to</p><p class="math-container">\[-\beta_{s}T_S+
(\alpha_{P}+\beta_{n}+\beta_{s})T_P
-\beta_{n}T_N
=
\alpha_{P}T_P^{0}\]</p><p>where the following coefficients are identified</p><p class="math-container">\[\begin{aligned}
    a_{S} &amp; = -\beta_{s}\\[8pt]
    a_{N} &amp; = -\beta_{n}\\[8pt]
    a_{P} &amp; = \alpha_{P}+\beta_{n}+\beta_{s}
\end{aligned}\]</p><p>and the standard format FVM discretization is reached</p><p class="math-container">\[a_ST_S + a_PT_P + a_NT_N = \alpha_{P}T_P^{0}\]</p><p>A condition for symmetry is that no flux traverses the center of the cylinder at <span>$r=0$</span>. That implies that <em>south</em> derivatives in discrete form of the equation must vanish to enforce <span>$\dot{q}(0,t)=0$</span>, so the first row of the problem is modified to</p><p class="math-container">\[a_1T_P + a_NT_N = \alpha_{P}T_P^{0}\quad\text{where}\quad{}a_1=\alpha_{P}+\beta_{n}\]</p><p>Over the external radius <span>$r=R$</span> a Robin boundary condition is imposed. In this case the heat flux <span>$\dot{q}=U(T_\infty-T_P)$</span> takes the place of <em>north</em> term in FVM discretization and the equation writes</p><p class="math-container">\[a_ST_S + a_RT_P = \alpha_{P}T_P^{0}+UT_\infty\quad\text{where}\quad{}a_R=\alpha_{P}+U+\beta_{s}\]</p><p>It must be noted here that <span>$U=Rh$</span>, where the actual heat transfer coefficient is <span>$h$</span>. This should be self-evident from a dimensional analysis.</p><h3 id="Spherical-coordinates-1-D"><a class="docs-heading-anchor" href="#Spherical-coordinates-1-D">Spherical coordinates 1-D</a><a id="Spherical-coordinates-1-D-1"></a><a class="docs-heading-anchor-permalink" href="#Spherical-coordinates-1-D" title="Permalink"></a></h3><p>In the case of spherical coordinates we start with a modification in divergence operator as follows</p><p class="math-container">\[\rho{}c_{p}\frac{\partial{}T}{\partial{}t}=
\frac{1}{r^2}\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)\]</p><p>The expression is again integrated over time and the differential volume <span>$dV$</span>.</p><p class="math-container">\[\int_{V}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}dtdV=
\int_{0}^{\tau}\int_{V}
\frac{1}{r^2}\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)dVdt\]</p><p>This differential volume is given by <span>$dV=r^2\sin\phi{}dr{}d\theta{}d\phi$</span>. Since the problem is specified to be symmetric around sphere center (this must include initial conditions), the polar and azimuth components can be moved outside the time and radial integration and lead to a common <span>$4\pi$</span> factor in both sides of the equation, which cancels out.</p><p class="math-container">\[\int_{0}^{\pi}\int_{0}^{2\pi}\sin\phi{}d\theta{}d\phi=4\pi\]</p><p>The integration over radial coordinate introduces the <span>$r^2dr$</span> factor from the differential volume and we get the final form of the equation to integrate.</p><p class="math-container">\[\int_{s}^{n}\int_{0}^{\tau}
\rho{}c_{p}\frac{\partial{}T}{\partial{}t}r^2dtdr=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)drdt\]</p><p>After effecting the inner integration and moving out constant terms from the integrals and expanding the evaluation of the definite integral between control volume boundaries <span>$s$</span> and <span>$n$</span> and performing a Crank-Nicolson integration of the right-hand side one gets</p><p class="math-container">\[\begin{aligned}
    \frac{\rho{}c_{p}}{\tau}
    \left(T_P^{\tau}-T_P^{0}\right)
    \left(\frac{r_n^3}{3}-\frac{r_s^3}{3}\right)
    &amp;=f\left[
    r_n^2k_n\frac{T_N^{\tau}-T_P^{\tau}}{\delta_{P,N}}-
    r_s^2k_s\frac{T_P^{\tau}-T_S^{\tau}}{\delta_{P,S}}
    \right]\\[8pt]
    &amp;+(1-f)\left[
    r_n^2k_n\frac{T_N^{0}-T_P^{0}}{\delta_{P,N}}-
    r_s^2k_s\frac{T_P^{0}-T_S^{0}}{\delta_{P,S}}
    \right]
\end{aligned}\]</p><p>Some coefficients appearing in the above equations are now grouped. Notice that for thermal conductivity <span>$k$</span> which is a function of temperature, the corresponding time-step temperature must be used for its evaluation. For <span>$\beta_{j}$</span> the lower case <span>$j$</span> represents the evaluation at the interface with control volume <span>$J$</span>, what is a very specific notation.</p><p class="math-container">\[\begin{aligned}
    \alpha_{P}  &amp; = \frac{\rho{}c_{p}}{3\tau}\left(r_n^3-r_s^3\right)\\[8pt]
    \beta_{j}   &amp; = \frac{r_j^2k_j}{\delta_{P,J}}
\end{aligned}\]</p><p>For conciseness we make <span>$g=(1-f)$</span> and simplify the expression with the new coefficients as</p><p class="math-container">\[-f\beta_{s}T_S+
(\alpha_{P}+f\beta_{n}+f\beta_{s})T_P
-f\beta_{n}T_N
=
g\beta_{s}T_S^{0}+
(\alpha_{P}-g\beta_{n}-g\beta_{s})T_P^{0}+
g\beta_{n}T_N^{0}\]</p><p>\subsection{Implicit implementation}</p><p>For the fully implicit time-stepping scheme <span>$f=1$</span> the expression reduces to</p><p class="math-container">\[-\beta_{s}T_S+
(\alpha_{P}+\beta_{n}+\beta_{s})T_P
-\beta_{n}T_N
=
\alpha_{P}T_P^{0}\]</p><p>where the following coefficients are identified</p><p class="math-container">\[\begin{aligned}
    a_{S} &amp; = -\beta_{s}\\[8pt]
    a_{N} &amp; = -\beta_{n}\\[8pt]
    a_{P} &amp; = \alpha_{P}+\beta_{n}+\beta_{s}
\end{aligned}\]</p><p>and the standard format FVM discretization is reached</p><p class="math-container">\[a_ST_S + a_PT_P + a_NT_N = \alpha_{P}T_P^{0}\]</p><p>A condition for symmetry is that no flux traverses the center of the sphere at <span>$r=0$</span>. That implies that <em>south</em> derivatives in discrete form of the equation must vanish to enforce <span>$\dot{q}(0,t)=0$</span>, so the first row of the problem is modified to</p><p class="math-container">\[a_1T_P + a_NT_N = \alpha_{P}T_P^{0}\quad\text{where}\quad{}a_1=\alpha_{P}+\beta_{n}\]</p><p>Over the external radius <span>$r=R$</span> a Robin boundary condition is imposed. In this case the heat flux <span>$\dot{q}=U(T_\infty-T_P)$</span> takes the place of <em>north</em> term in FVM discretization and the equation writes</p><p class="math-container">\[a_ST_S + a_RT_P = \alpha_{P}T_P^{0}+UT_\infty\quad\text{where}\quad{}a_R=\alpha_{P}+U+\beta_{s}\]</p><p>It must be noted here that <span>$U=R^2h$</span>, where the actual heat transfer coefficient is <span>$h$</span>. This should be self-evident from a dimensional analysis.</p><h2 id="Heat-conduction-formulated-in-enthalpy"><a class="docs-heading-anchor" href="#Heat-conduction-formulated-in-enthalpy">Heat conduction formulated in enthalpy</a><a id="Heat-conduction-formulated-in-enthalpy-1"></a><a class="docs-heading-anchor-permalink" href="#Heat-conduction-formulated-in-enthalpy" title="Permalink"></a></h2><h3 id="Spherical-coordinates-1-D-2"><a class="docs-heading-anchor" href="#Spherical-coordinates-1-D-2">Spherical coordinates 1-D</a><a class="docs-heading-anchor-permalink" href="#Spherical-coordinates-1-D-2" title="Permalink"></a></h3><p>Heat equation for a constant density phase using enthalpy as dependent variable is stated as:</p><p class="math-container">\[\rho{}\frac{\partial{}h}{\partial{}t}=\nabla\cdotp{}(k\nabla{}T)\]</p><p>For computing the heating dynamics in a sphere, using the definition of divergence in spherical coordinates and using the gradient expansion over the radius we have</p><p class="math-container">\[\rho{}\frac{\partial{}h}{\partial{}t}=
\frac{1}{r^2}\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)\]</p><p>This is now integrated over the differential volume <span>$dV$</span> as described in previous sections and for conciseness we skip that discussion. The integration over radial coordinate introduces the <span>$r^2dr$</span> factor from the differential volume and we get the final form of the equation to integrate.</p><p class="math-container">\[\int_{s}^{n}\int_{0}^{\tau}
\rho{}\frac{\partial{}h}{\partial{}t}r^2dtdr=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}r}
\left(r^2k\frac{\partial{}T}{\partial{}r}\right)drdt\]</p><p>After effecting the inner integrations and moving out constant terms from the integrals and expanding the evaluation of the definite integral between control volume boundaries <span>$s$</span> and <span>$n$</span> and performing a Crank-Nicolson integration of the right-hand side one gets</p><p class="math-container">\[\begin{align}
\frac{\rho{}}{\tau}
\left(h_P^{\tau}-h_P^{0}\right)
\left(\frac{r_n^3}{3}-\frac{r_s^3}{3}\right)
&amp;=f\left[
r_n^2k_n\frac{T_N^{\tau}-T_P^{\tau}}{\delta_{P,N}}-
r_s^2k_s\frac{T_P^{\tau}-T_S^{\tau}}{\delta_{P,S}}
\right]\\[8pt]
&amp;+(1-f)\left[
r_n^2k_n\frac{T_N^{0}-T_P^{0}}{\delta_{P,N}}-
r_s^2k_s\frac{T_P^{0}-T_S^{0}}{\delta_{P,S}}
\right]
\end{align}\]</p><p>Some coefficients appearing in the above equations are now grouped. Notice that for thermal conductivity <span>$k$</span> which is a function of temperature, the corresponding time-step temperature must be used for its evaluation. For <span>$\beta_{j}$</span> the lower case <span>$j$</span> represents the evaluation at the interface with control volume <span>$J$</span>, what is a very specific notation.</p><p class="math-container">\[\begin{align}
\alpha_{P}  &amp; = \frac{\rho{}}{3\tau}\left(r_n^3-r_s^3\right)\\[8pt]
\beta_{j}   &amp; = \frac{r_j^2k_j}{\delta_{P,J}}
\end{align}\]</p><p>For conciseness we make <span>$g=(1-f)$</span> and simplify the expression with the new coefficients as</p><p class="math-container">\[\begin{align}
\alpha_{P}h_P^{\tau}-\alpha_{P}h_P^{0}

&amp;=f\beta_{n}T_N^{\tau}-f(\beta_{n}+\beta_{s})T_P^{\tau}-f\beta_{s}T_S^{\tau}
\\[8pt]
&amp;+g\beta_{n}T_N^{0}-g(\beta_{n}+\beta_{s})T_P^{0}-g\beta_{s}T_S^{0}
\end{align}\]</p><p>For the fully implicity time-stepping scheme <span>$f=1$</span> and making <span>$\gamma_{j}^{k}=\alpha_{P}^{-1}\beta_{j}^{k}$</span> one gets</p><p class="math-container">\[h_P^{\tau}-h_P^{0}-\gamma_{n}^{k}T_N^{\tau,k}+(\gamma_{n}^{k}+\gamma_{s}^{k})T_P^{\tau,k}-\gamma_{s}^{k}T_S^{\tau,k}=0\]</p><p>A condition for symmetry is that no flux traverses the center of the sphere at <span>$r=0$</span>. That implies that <em>south</em> derivatives in discretizes form of the equation must vanish to enforce <span>$\dot{q}(0,t)=0$</span>, so the first row of the problem is modified to</p><p class="math-container">\[h_P^{\tau}-h_P^{0}-\gamma_{n}^{k}T_N^{\tau,k}+\gamma_{n}^{k}T_P^{\tau,k}=0\]</p><p>Over the external radius <span>$r=R$</span> a Robin boundary condition is imposed. In this case the heat flux <span>$\dot{q}=U(T_\infty-T_P)$</span> takes the place of <em>north</em> term in FVM discretization and the equation writes</p><p class="math-container">\[h_P^{\tau}-h_P^{0}-\alpha_{P}^{-1}UT_{\infty}+(\alpha_{P}^{-1}U+\gamma_{s}^{k})T_P^{\tau,k}-\gamma_{s}^{k}T_S^{\tau,k}=0\]</p><p>It must be noted here that <span>$U=R^2h$</span>, where the actual heat transfer coefficient is <span>$h$</span>. This should be self-evident from a dimensional analysis.</p><p>This is no longer a linear problem and thus cannot be solved directly. We need now an strategy for solving this coupled system of nonlinear equations. The iterative solution of the problem is indicated in the above equations through the introduction of superscript <span>$k$</span> indicating the iteration number. One can rework the system as</p><p class="math-container">\[\begin{align}
-\gamma_{1,2}^{k}T_2^{\tau,k}+\gamma_{1,2}^{k}T_1^{\tau,k}+h_1^{\tau}&amp;=h_1^{0}\\
&amp;\dots \\
-\gamma_{n}^{k}T_N^{\tau,k}+(\gamma_{n}^{k}+\gamma_{s}^{k})T_P^{\tau,k}-\gamma_{s}^{k}T_S^{\tau,k}+h_P^{\tau}&amp;=h_P^{0}\\
&amp;\dots \\
(\alpha_{K}^{-1}U+\gamma_{K-1,K}^{k})T_K^{\tau,k}-\gamma_{K-1,K}^{k}T_{K-1}^{\tau,k}+h_K^{\tau}&amp;=h_K^{0}+\alpha_{K}^{-1}UT_{\infty}
\end{align}\]</p><p>It is clear now that for implementation purposes one can store the required coefficients in a tridiagonal matrix <span>$A^{k}$</span>. Making <span>$\Gamma_{i}=(\gamma_{i-1,i}+\gamma_{i,i+1})$</span> and <span>$\tilde{U}=\alpha_{K}^{-1}U$</span> we can identify the terms in</p><p class="math-container">\[\begin{pmatrix}
H_{1}^{k}    \\
H_{2}^{k}    \\
H_{3}^{k}    \\
\vdots   \\
H_{K-1}^{k}  \\
H_{K}^{k}    \\
\end{pmatrix}
=
\begin{pmatrix}
 \gamma_{1,2}^{k} &amp; -\gamma_{1,2}^{k} &amp;  0                &amp; \dots  &amp; 0 &amp; 0 \\
-\gamma_{1,2}^{k} &amp;  \Gamma_{2}^{k}   &amp; -\gamma_{2,3}^{k} &amp; \dots  &amp; 0 &amp; 0 \\
 0 &amp; -\gamma_{2,3}^{k} &amp;  \Gamma_{3}^{k} &amp; -\gamma_{3,4}^{k}\ddots &amp;  0 &amp;  0 \\
\vdots  &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots  &amp; \vdots \\
 0 &amp;  0 &amp; 0 &amp; -\gamma_{K-2,K-1}^{k} &amp;  \Gamma_{K-1}^{k}   &amp; -\gamma_{K-1,K}^{k} \\
 0      &amp;  0     &amp;  0     &amp;  0     &amp; -\gamma_{K-1,K}^{k} &amp; \tilde{U}+\gamma_{K-1,K}^{k} \\
\end{pmatrix}
\begin{pmatrix}
T_{1}^{\tau,k}   \\
T_{2}^{\tau,k}   \\
T_{3}^{\tau,k}   \\
\vdots           \\
T_{K-1}^{\tau,k} \\
T_{N}^{\tau,k}   \\
\end{pmatrix}\]</p><p>Since the temperature vector <span>$T^{\tau,k}$</span> is updated every iteration, the coefficients of <span>$A^{k}$</span> must also be updated. With the intermediate vector <span>$H^{\tau,k}$</span> the nonlinear problem is rewriten as</p><p class="math-container">\[\begin{pmatrix}
H_{1}^{k}    \\
H_{2}^{k}    \\
H_{3}^{k}    \\
\vdots       \\
H_{K-1}^{k}  \\
H_{K}^{k}    \\
\end{pmatrix}
+
\begin{pmatrix}
h_{1}^{\tau}   \\
h_{2}^{\tau}   \\
h_{3}^{\tau}   \\
\vdots         \\
h_{K-1}^{\tau} \\
h_{K}^{\tau}   \\
\end{pmatrix}
=
\begin{pmatrix}
h_1^{0}                 \\
h_2^{0}                 \\
h_3^{0}                 \\
\vdots                  \\
h_{K-1}^{0}             \\
h_{K}^{0} + \tilde{U}T_{\infty} \\
\end{pmatrix}\]</p><p>The choice not to write the problem in this format reflects the fact that the term <span>$H^{\tau,k}$</span> on the left-hand side is updated on a iteration basis, while the vector <span>$b^{0}$</span> is computed once per time step. This last vector was called <span>$b^{0}$</span> instead of <span>$h^{0}$</span> because it also includes the boundary condition in its last element. This is useful for the conception of the inner and outer loop functions used for solution update.</p><p>The traditional approach to solve this sort of problems is to provide a <em>initial guess</em> <span>$T^{\tau,0}=T^{0}$</span>.</p><p class="math-container">\[\begin{align}
h^{\tau,0}               &amp;= b^{0}-A^{0}T^{\tau,0}\\
h(T^{\tau,1})-h^{\tau,0} &amp;= 0\\
\Delta{}T                &amp;= T^{\tau,1}-T^{\tau,0}\\
T^{\tau,1}               &amp;= T^{\tau,0}+(1-\alpha)\Delta{}T\\
\varepsilon^{1}          &amp;= \vert\Delta{}T\vert\\
&amp;\text{repeat}\\
h^{\tau,1}               &amp;= b^{0}-A^{1}T^{\tau,1}\\
h(T^{\tau,2})-h^{\tau,1} &amp;= 0\\
\Delta{}T                &amp;= T^{\tau,2}-T^{\tau,1}\\
T^{\tau,2}               &amp;= T^{\tau,1}+(1-\alpha)\Delta{}T\\
\varepsilon^{2}          &amp;= \vert\Delta{}T\vert\\
&amp;\dots\\
h^{\tau,k}                 &amp;= b^{0}-A^{k}T^{\tau,k}\\
h(T^{\tau,k+1})-h^{\tau,k} &amp;= 0\\
\Delta{}T                  &amp;= T^{\tau,k+1}-T^{\tau,k}\\
T^{\tau,k+1}               &amp;= T^{\tau,k}+(1-\alpha)\Delta{}T\\
\varepsilon^{k+1}          &amp;= \vert\Delta{}T\vert\\
\end{align}\]</p><h2 id="Mass-transfer"><a class="docs-heading-anchor" href="#Mass-transfer">Mass transfer</a><a id="Mass-transfer-1"></a><a class="docs-heading-anchor-permalink" href="#Mass-transfer" title="Permalink"></a></h2><h3 id="Carbon-diffusion-in-plain-iron"><a class="docs-heading-anchor" href="#Carbon-diffusion-in-plain-iron">Carbon diffusion in plain iron</a><a id="Carbon-diffusion-in-plain-iron-1"></a><a class="docs-heading-anchor-permalink" href="#Carbon-diffusion-in-plain-iron" title="Permalink"></a></h3><p class="math-container">\[\frac{\partial{}x}{\partial{}t}=\nabla\cdotp{}(D(x)\nabla{}T)\]</p><p class="math-container">\[\frac{\partial{}x}{\partial{}t}=
\frac{\partial}{\partial{}x}
\left(D(x)\frac{\partial{}x}{\partial{}z}\right)\]</p><p class="math-container">\[\int_{s}^{n}\int_{0}^{\tau}
\frac{\partial{}x}{\partial{}t}dtdz=
\int_{0}^{\tau}\int_{s}^{n}
\frac{\partial}{\partial{}z}
\left(D(x)\frac{\partial{}x}{\partial{}z}\right)dzdt\]</p><p class="math-container">\[\left(x_P^{\tau}-x_P^{0}\right)(w_{n}-w_{s})=
\int_{0}^{\tau}
\left(D(x)\frac{\partial{}T}{\partial{}r}\right)\bigg\vert_{s}^{n}dt\]</p><p class="math-container">\[\begin{align}
\left(x_P^{\tau}-x_P^{0}\right)\frac{(w_{n}-w_{s})}{\tau}&amp;=
f\left[
D(x_n)\frac{x_N^{\tau}-x_P^{\tau}}{\delta_{P,N}}-
D(x_s)\frac{x_P^{\tau}-x_S^{\tau}}{\delta_{P,S}}
\right]\\[8pt]
&amp;+(1-f)\left[
D(x_n)\frac{x_N^{0}-x_P^{0}}{\delta_{P,N}}-
D(x_s)\frac{x_P^{0}-x_S^{0}}{\delta_{P,S}}
\right]
\end{align}\]</p><p class="math-container">\[\begin{align}
\alpha_{P}  &amp; = \frac{(w_{n}-w_{s})}{\tau}\\[8pt]
\beta_{j}   &amp; = \frac{D(x_j)}{\delta_{P,J}}
\end{align}\]</p><p class="math-container">\[-f\beta_{s}x_S+
(\alpha_{P}+f\beta_{n}+f\beta_{s})x_P
-f\beta_{n}x_N
=
g\beta_{s}x_S^{0}+
(\alpha_{P}-g\beta_{n}-g\beta_{s})x_P^{0}+
g\beta_{n}x_N^{0}\]</p><p class="math-container">\[-\beta_{s}x_S+
(\alpha_{P}+\beta_{n}+\beta_{s})x_P
-\beta_{n}x_N
=
\alpha_{P}x_P^{0}\]</p><p class="math-container">\[\begin{align}
a_{S} &amp; = -\beta_{s}\\[8pt]
a_{N} &amp; = -\beta_{n}\\[8pt]
a_{P} &amp; = \alpha_{P}+\beta_{n}+\beta_{s}
\end{align}\]</p><p class="math-container">\[a_Sx_S + a_Px_P + a_Nx_N = \alpha_{P}x_P^{0}\]</p><p class="math-container">\[a_1x_P + a_Nx_N = \alpha_{P}x_P^{0}\quad\text{where}\quad{}a_1=\alpha_{P}+\beta_{n}\]</p><p class="math-container">\[a_Sx_S + a_Rx_P = \alpha_{P}x_P^{0}+hx_\infty\quad\text{where}\quad{}a_R=\alpha_{P}+h+\beta_{s}\]</p><div class="admonition is-info"><header class="admonition-header">About mass intake calculation</header><div class="admonition-body"></div></div><p class="math-container">\[\rho_{Fe} = \frac{m_{Fe}}{V_{cell}}\]</p><p class="math-container">\[y_{C} = \frac{m_{C}}{m_{Fe} + m_{C}}\]</p><p class="math-container">\[m_{Fe+C} = \frac{m_{Fe}}{1 - y_{C}}\]</p><p class="math-container">\[\rho_{Fe+C} = \rho_{Fe}\frac{1}{1 - y_{C}}\]</p><p class="math-container">\[\sigma = \int_{0}^{L}\rho(z)y_{C}(z)dz\]</p><p class="math-container">\[\sigma = \rho_{Fe}\int_{0}^{L}\frac{y_{C}(z)}{1-y_{C}(z)}dz\]</p><p class="math-container">\[\Delta\sigma = \rho_{Fe}\left(\int_{0}^{L}\frac{y_{C}(z)}{1-y_{C}(z)}dz\right)\biggr\vert_{t=0}^{t=t_{f}}\]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../DryTooling/">« DryTooling Core</a><a class="docs-footer-nextpage" href="../../Granular/theory/">Granular models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Monday 30 October 2023 16:11">Monday 30 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
